#include "Console.h"
#include <time.h>
//#include "Main.cpp"

#define UP		72
#define DOWN	80
#define LEFT	75
#define RIGHT	77

//맵을 그립니다. 
char ShowMap[21][108] =
{
	" -------------------------------------------------------------------------------------------------------- ",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|........................................................................................................|",
	"|.......................................................................................................#|",
	" -------------------------------------------------------------------------------------------------------- "
};

char backgroundMap[21][108];

//이동처리
void gotoXY(int x, int y)
{
	HANDLE hOut;
	COORD Cur;
	hOut = GetStdHandle(STD_OUTPUT_HANDLE);
	Cur.X = x;
	Cur.Y = y;
	SetConsoleCursorPosition(hOut, Cur);
}

//키를 입력 받습니당
int GetKeyDown()
{
	if (_kbhit() != 0)
	{
		return _getch();
	}

	return 0;

}

//화면을 그려용
void displayScreen(int x, int y)
{
	{
		srand((unsigned)time(NULL)); //랜덤으로

		for (int y = 0; y < 21; y++) //가로로 21번줄까지
		{
			for (int x = 0; x < 108; x++) // 세로로 108번줄까지
			{
				gotoXY(x, y);
				//cout << ShowMap[y][x];
				_putch(ShowMap[y][x]);
			}
		}

		gotoXY(x, y); //현재 위치
		_putch('@'); //플레이어
	}
}

void Init() // 재설정 다시 그린다. 
{
	for (int i = 0; i < 21; i++)
	{
		for (int j = 0; j < 106; j++)
		{
			if (ShowMap[i][j] != '|' && ShowMap[i][j] != '-' && ShowMap[i][j] != ' ' && ShowMap[i][j] != '#') //'|'와 '-'와 ' '와 '#'을 제외하고
			{
				ShowMap[i][j] = '.'; //전부 점으로 그린다
			}

		}
	}
}

void createMaze(int& randomX, int& randomY) //미로를 랜덤으로 생성한다.
{
	Init();
	for (int i = 0; i < 370; i++) // 가운데 들어가는 수까지. 즉 벽은 < x까지 생성된다. 
	{
		randomX = rand() % 21;	//가로를 21번까지 돌려요.
		randomY = rand() % 108; // 세로로 108번까지 돌려요

		if (ShowMap[randomX][randomY] == '.') //만약 .이라면
		{
			i--; //중복처리
			ShowMap[randomX][randomY] = '+'; // +로 바꾸어요
			continue;
		}
	}

	for (int i = 0; i < 2; i++) // 가운데 들어가는 수까지. 즉 벽은 < x까지 생성된다. 
	{
		randomX = rand() % 21;	//가로를 21번까지 돌려요.
		randomY = rand() % 108; // 세로로 108번까지 돌려요

		if (ShowMap[randomX][randomY] == '.' && ShowMap[randomX][randomY] != '+') //만약 .이라면
		{
			i--; //중복처리
			ShowMap[randomX][randomY] = '$'; // +로 바꾸어요
			continue;
		}
	}
}

//시작할 때 나오는 음악
char Mycurse[10] =
{
	'A', 'c', 'E', 'F', 'E', 'c', 'B', 'C', 'D', 'c',
};

//음악을 재생해요
void playMusic()
{
	char Tone = 0; //초기화. 

	//Beep(523.25, 1000);  //도, C
	//Beep(587.33, 1000);  //레, D
	//Beep(659.26, 1000);  //미, E
	//Beep(698.46, 1000);  //파, F
	//Beep(783.99, 1000);  //솔, G
	//Beep(880.00, 1000);  //라, A	
	//Beep(987.77, 1000);  //시, B
	//Beep(1046.50, 1000);  //도, C

	for (int i = 0; i < 10; i++) //10음을 불러요
	{
		Tone = Mycurse[i];

		switch (Tone) //톤에 들어가는 게 무엇이냐 에 따라 노래를 부른다.
		{
		case 'c':
			Beep(523.25, 500);
			break;
		case 'D':
			Beep(587.33, 500);
			break;
		case 'E':
			Beep(659.26, 500);
			break;
		case 'F':
			Beep(698.46, 500);
			break;
		case 'G':
			Beep(783.99, 500);
			break;
		case 'A':
			Beep(880.00, 500);
			break;
		case 'B':
			Beep(987.77, 500);
			break;
		case 'C':
			Beep(1046.50, 500);
			break;
		default:
			break;
		}
	}
}